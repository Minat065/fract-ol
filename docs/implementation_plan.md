# Fract-ol 実装計画書

## 概要
本文書は、fract-olプロジェクトの実装を小さな単位に分割し、段階的に開発を進めるための計画書です。

## フェーズ1: 基盤整備

### 1.1 プロジェクト依存関係の準備
- [ ] libftライブラリをプロジェクトに追加
- [ ] libft/Makefileを作成
- [ ] ft_atof関数をlibftに実装
- [ ] ft_printf関数の動作確認
- [ ] MinilibXライブラリの取得とセットアップ
- [ ] Makefileでlibftのビルドを統合

### 1.2 基本構造体の定義
- [ ] ウィンドウ情報構造体(t_win)を定義
  - [ ] mlx_ptrフィールドを追加
  - [ ] win_ptrフィールドを追加
  - [ ] widthフィールドを追加
  - [ ] heightフィールドを追加
- [ ] 画像情報構造体(t_img)を定義
  - [ ] img_ptrフィールドを追加
  - [ ] addrフィールドを追加
  - [ ] bits_per_pixelフィールドを追加
  - [ ] line_lengthフィールドを追加
  - [ ] endianフィールドを追加
- [ ] フラクタル情報構造体(t_fractal)を定義
  - [ ] typeフィールドを追加（MANDELBROT, JULIA, BURNING_SHIP）
  - [ ] zoom_levelフィールドを追加
  - [ ] offset_xフィールドを追加
  - [ ] offset_yフィールドを追加
  - [ ] julia_realフィールドを追加
  - [ ] julia_imagフィールドを追加
  - [ ] max_iterフィールドを追加
- [ ] メイン構造体(t_data)を定義
  - [ ] winフィールドを追加
  - [ ] imgフィールドを追加
  - [ ] fractalフィールドを追加

## フェーズ2: ウィンドウ管理基盤

### 2.1 MLX初期化
- [ ] init_mlx関数を実装
  - [ ] mlx_init()を呼び出し
  - [ ] エラーハンドリングを実装
- [ ] create_window関数を実装
  - [ ] mlx_new_window()を呼び出し
  - [ ] ウィンドウタイトルを設定
  - [ ] デフォルトサイズ（800x600）を設定
- [ ] create_image関数を実装
  - [ ] mlx_new_image()を呼び出し
  - [ ] mlx_get_data_addr()でアドレス取得
  - [ ] エラーハンドリングを実装

### 2.2 ピクセル操作
- [ ] my_mlx_pixel_put関数を実装
  - [ ] 境界チェックを実装
  - [ ] ピクセルアドレス計算を実装
  - [ ] 色情報の書き込みを実装
- [ ] clear_image関数を実装
  - [ ] 全ピクセルを黒でクリア
- [ ] put_image_to_window関数を実装
  - [ ] mlx_put_image_to_window()のラッパー

## フェーズ3: イベント処理

### 3.1 キーボードイベント
- [ ] key_hook関数を実装
  - [ ] ESCキー（53 or 65307）の処理を実装
  - [ ] 矢印キーの処理を準備（上下左右）
  - [ ] +/-キーの処理を準備（イテレーション数変更）
  - [ ] Rキーの処理を準備（リセット）
- [ ] handle_esc関数を実装
  - [ ] ウィンドウの破棄
  - [ ] メモリの解放
  - [ ] プログラムの正常終了

### 3.2 マウスイベント
- [ ] mouse_hook関数を実装
  - [ ] マウスホイールアップの検出（ボタン4）
  - [ ] マウスホイールダウンの検出（ボタン5）
  - [ ] クリック座標の取得
- [ ] zoom_in関数を実装
  - [ ] ズーム倍率を1.1倍に
  - [ ] クリック位置を中心に調整
- [ ] zoom_out関数を実装
  - [ ] ズーム倍率を0.9倍に
  - [ ] クリック位置を中心に調整

### 3.3 ウィンドウイベント
- [ ] close_hook関数を実装
  - [ ] Xボタンクリック時の処理
  - [ ] handle_escと同じ処理を呼び出し
- [ ] expose_hook関数を実装
  - [ ] ウィンドウ再描画の処理

## フェーズ4: 数学的計算

### 4.1 座標変換
- [ ] screen_to_complex関数を実装
  - [ ] スクリーン座標をピクセル単位で受け取り
  - [ ] 複素平面の座標に変換
  - [ ] ズームとオフセットを考慮
- [ ] scale_color関数を実装
  - [ ] イテレーション数から色値への変換

### 4.2 マンデルブロ集合
- [ ] mandelbrot_calc関数を実装
  - [ ] z = z^2 + cの計算
  - [ ] 発散判定（|z| > 2）
  - [ ] イテレーション数のカウント
- [ ] draw_mandelbrot関数を実装
  - [ ] 各ピクセルでmandelbrot_calcを呼び出し
  - [ ] 色の計算と設定

### 4.3 ジュリア集合
- [ ] julia_calc関数を実装
  - [ ] z = z^2 + cの計算（cは固定値）
  - [ ] 発散判定（|z| > 2）
  - [ ] イテレーション数のカウント
- [ ] draw_julia関数を実装
  - [ ] 各ピクセルでjulia_calcを呼び出し
  - [ ] 色の計算と設定


## フェーズ5: カラーリング

### 5.1 基本カラーパレット
- [ ] create_color関数を実装
  - [ ] RGB値を1つの整数に変換
- [ ] get_color_linear関数を実装
  - [ ] イテレーション数に基づく線形グラデーション
- [ ] get_color_psychedelic関数を実装
  - [ ] サイケデリックな色変化の実装

### 5.2 高度なカラーリング
- [ ] smooth_coloring関数を実装
  - [ ] スムーズな色遷移のアルゴリズム
- [ ] multi_gradient関数を実装
  - [ ] 複数のグラデーションを組み合わせ
- [ ] hsv_to_rgb関数を実装
  - [ ] HSV色空間からRGBへの変換

## フェーズ6: 描画最適化

### 6.1 レンダリング
- [ ] render_fractal関数を実装
  - [ ] フラクタルタイプに応じて描画関数を選択
  - [ ] 画像バッファに描画
  - [ ] ウィンドウに表示
- [ ] progressive_render関数を実装
  - [ ] 低解像度から高解像度への段階的描画


## フェーズ7: UI機能拡張

### 7.1 操作性向上
- [ ] パン機能の実装
  - [ ] マウスドラッグでの移動
  - [ ] 矢印キーでの移動
- [ ] ズーム機能の改善
  - [ ] スムーズズームの実装
  - [ ] ズームレベル表示

### 7.2 情報表示
- [ ] display_info関数を実装
  - [ ] 現在のズームレベル表示
  - [ ] 座標表示
  - [ ] イテレーション数表示
- [ ] help_display関数を実装
  - [ ] 操作方法の表示

## フェーズ8: エラー処理と検証

### 8.1 入力検証
- [ ] validate_args関数を強化
  - [ ] フラクタルタイプの検証
  - [ ] ジュリア集合パラメータの検証
  - [ ] 範囲チェック
- [ ] parse_double関数を実装
  - [ ] 文字列から浮動小数点への変換
  - [ ] エラーハンドリング

### 8.2 メモリ管理
- [ ] cleanup関数を実装
  - [ ] 全てのメモリ解放
  - [ ] MLXリソースの解放
- [ ] error_exit関数を実装
  - [ ] エラーメッセージ表示
  - [ ] クリーンアップ
  - [ ] 正常終了

## フェーズ9: テストと仕上げ

### 9.1 機能テスト
- [ ] マンデルブロ集合の表示テスト
- [ ] ジュリア集合の表示テスト（複数パラメータ）
- [ ] ズーム機能のテスト
- [ ] キーボード操作のテスト
- [ ] マウス操作のテスト
- [ ] ウィンドウ操作のテスト

### 9.2 エッジケーステスト
- [ ] 無効な引数のテスト
- [ ] メモリリークのチェック（valgrind）
- [ ] 極端なズームレベルのテスト
- [ ] ウィンドウリサイズのテスト

### 9.3 最終調整
- [ ] Norminetteチェック
- [ ] コード整理とコメント削除
- [ ] パフォーマンス最適化
- [ ] README.mdの作成

## 実装順序の推奨

1. **フェーズ1-2**: 基盤を整える（1-2日）
2. **フェーズ3**: 基本的なイベント処理（1日）
3. **フェーズ4.1-4.2**: マンデルブロ集合を動かす（1日）
4. **フェーズ5.1**: 基本的な色付け（半日）
5. **フェーズ6**: 描画の統合（半日）
6. **フェーズ4.3**: ジュリア集合の追加（半日）
7. **フェーズ7-8**: UI改善とエラー処理（1日）
8. **フェーズ9**: テストと仕上げ（1日）

## 注意事項

- 各タスクは独立して実装・テスト可能な単位にする
- 常にコンパイルが通る状態を維持する
- 各フェーズ完了時点で動作確認を行う
- Norminetteに準拠したコードを書く
- メモリリークに注意する